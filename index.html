<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiling & Cache Behavior Visualizer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Mode Selection Banner -->
    <nav class="mode-banner">
        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="matmul">Matrix Multiply</button>
            <button class="mode-tab" data-mode="conv2d">2D Convolution</button>
        </div>
    </nav>

    <div class="container">
        <header class="page-header">
            <h1 id="pageTitle">Matrix Multiplication: Tiling & Cache Visualization</h1>
            <button class="help-btn" id="helpBtn" title="Take a guided tour">?</button>
        </header>

        <!-- Configuration Panel -->
        <div class="config-panel">
            <div class="config-group">
                <label>Loop Order</label>
                <select id="loopOrder">
                    <option value="ijk">ijk (i -> j -> k)</option>
                    <option value="ikj">ikj (i -> k -> j)</option>
                    <option value="jik">jik (j -> i -> k)</option>
                    <option value="jki">jki (j -> k -> i)</option>
                    <option value="kij">kij (k -> i -> j)</option>
                    <option value="kji">kji (k -> j -> i)</option>
                </select>
            </div>

            <div class="config-group">
                <label>Tiling</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="tilingEnabled">
                    <span>Enable Tiling</span>
                </div>
            </div>

            <div class="config-group">
                <label>Tile Size</label>
                <select id="tileSize" disabled>
                    <option value="2">2x2</option>
                    <option value="4" selected>4x4</option>
                    <option value="6">6x6</option>
                </select>
            </div>

            <div class="config-group">
                <label>Data Layout</label>
                <div class="layout-group" id="layoutControls">
                    <!-- Generated dynamically from operation.tensors -->
                </div>
            </div>

            <div class="config-group">
                <label>Cache Line</label>
                <div class="cache-config">
                    <select id="elementsPerLine">
                        <option value="2">2 elem</option>
                        <option value="4">4 elem</option>
                        <option value="8">8 elem</option>
                        <option value="16" selected>16 elem</option>
                    </select>
                    <span class="byte-equiv" id="lineSizeBytes">= 64B</span>
                </div>
            </div>

            <div class="config-group">
                <label>Cache Capacity</label>
                <div class="cache-config">
                    <select id="numCacheLines">
                        <option value="4" selected>4 lines</option>
                        <option value="8">8 lines</option>
                        <option value="16">16 lines</option>
                    </select>
                    <span class="byte-equiv" id="cacheSizeBytes">= 256B</span>
                </div>
            </div>

            <button class="btn" id="applyConfig">Apply & Reset</button>
        </div>

        <!-- Main Area -->
        <div class="main-area">
            <!-- Visualization Section -->
            <div class="visualization-section">
                <!-- Tensor Display (generated dynamically from operation) -->
                <div class="matrices-container" id="tensorsContainer">
                    <!-- Generated dynamically from operation.tensors -->
                </div>

                <!-- Memory Layout (Linear Address Space) -->
                <div class="memory-layout-section">
                    <div class="memory-layout-label">Memory Layout (Linear Address Space)</div>
                    <canvas id="memoryLayout" class="memory-layout-canvas"></canvas>
                </div>

                <!-- Playback Controls -->
                <div class="playback-controls">
                    <button class="playback-btn" id="resetBtn" title="Reset">|&lt;</button>
                    <button class="playback-btn" id="stepBackBtn" title="Step Back">&lt;&lt;</button>
                    <button class="playback-btn play-btn" id="playPauseBtn" title="Play/Pause">&#9654;</button>
                    <button class="playback-btn" id="stepFwdBtn" title="Step Forward">&gt;&gt;</button>

                    <div class="speed-control">
                        <label>Speed:</label>
                        <input type="range" id="speedSlider" min="0" max="100" value="50">
                        <span id="speedDisplay">10x</span>
                    </div>

                    <div class="iteration-jump">
                        <label>Jump to:</label>
                        <input type="number" id="jumpIteration" min="0" max="1727" value="0">
                        <span class="iteration-display">/ <span id="totalIterations">1728</span></span>
                    </div>
                </div>

                <!-- Overall Stats -->
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="totalMem">0</div>
                        <div class="stat-label">Total Memory Accesses</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalHits">0</div>
                        <div class="stat-label">Cache Hits</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="hitRate">0%</div>
                        <div class="stat-label">Hit Rate</div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="timeline-section">
                    <div class="timeline-label" id="timelineLabel">Cache Hit Global Timeline (A | B | C)</div>
                    <canvas id="timeline" class="timeline-canvas"></canvas>
                </div>
            </div>

            <!-- Side Panel -->
            <div class="side-panel">
                <!-- Code Display -->
                <div class="panel-section">
                    <div class="panel-title">Loop Structure</div>
                    <div class="code-display" id="codeDisplay">
                        <!-- Code will be generated here -->
                    </div>
                </div>

                <!-- Current State -->
                <div class="panel-section">
                    <div class="panel-title">Current State</div>
                    <div class="state-grid">
                        <span class="state-label">Iteration:</span>
                        <span class="state-value" id="currentIteration">0 of 1728</span>

                        <span class="state-label">Indices:</span>
                        <span class="state-value" id="currentIndices">i=0, j=0, k=0</span>

                        <span class="state-label">Operation:</span>
                        <span class="state-value" id="currentOp">-</span>
                    </div>
                </div>

                <!-- Per-Tensor Stats -->
                <div class="panel-section">
                    <div class="panel-title">Per-Tensor Statistics</div>
                    <div class="matrix-stats-grid" id="tensorStatsContainer">
                        <!-- Generated dynamically from operation.tensors -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Guided Tour -->
    <div id="tourOverlay" class="tour-overlay hidden"></div>
    <div id="tourTooltip" class="tour-tooltip hidden">
        <div class="tour-header">
            <span class="tour-step-indicator" id="tourStepIndicator">1 / 5</span>
            <button class="tour-close" id="tourClose" title="Exit tour">&times;</button>
        </div>
        <h3 class="tour-title" id="tourTitle">Welcome</h3>
        <p class="tour-content" id="tourContent">Tour content here</p>
        <div class="tour-nav">
            <button class="tour-btn" id="tourPrev">Previous</button>
            <button class="tour-btn tour-btn-primary" id="tourNext">Next</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
